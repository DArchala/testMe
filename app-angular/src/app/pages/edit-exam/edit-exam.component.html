<form id="new-exam-container"
      (ngSubmit)="saveExam('Czy chcesz zapisać zmiany w egzaminie?')"
      [formGroup]="newExamForm">

  <div id="new-exam-data">
    <mat-form-field appearance="outline">
      <mat-label>Nazwa egzaminu</mat-label>
      <input type="text" matInput [formControl]="examNameControl">
      <mat-error *ngIf="examNameControl.hasError('required')">
        Nazwa egzaminu jest wymagana
      </mat-error>
      <mat-error *ngIf="examNameControl.hasError('minlength')
              || examNameControl.hasError('maxlength')">
        Nazwa egzaminu musi zawierać od 1 do 255 znaków
      </mat-error>
    </mat-form-field>

    <mat-form-field appearance="outline">
      <mat-label>Poziom trudności</mat-label>
      <mat-select [formControl]="difficultyLevelControl">
        <mat-option *ngFor="let level of difficultyLevels" [value]="level">
          {{level}}
        </mat-option>
      </mat-select>
      <mat-error
        *ngIf="difficultyLevelControl.hasError('required')">
        Poziom trudności jest wymagany
      </mat-error>
    </mat-form-field>

    <mat-form-field appearance="outline">
      <mat-label>Czas egzaminu</mat-label>
      <input [formControl]="examTimeControl" matInput mdc-datetime-picker="" date="false" time="true" type="text"
             id="timeedit"
             placeholder="HH:MM" show-todays-date="" minutes="true" min-date="date" edit-input="true"
             show-icon="true" ngModel="" class=" dtp-no-msclear dtp-input md-input">
      <mat-error
        *ngIf="examTimeControl.hasError('required')">
        Czas egzaminu jest wymagany
      </mat-error>
      <mat-error
        *ngIf="examTimeControl.hasError('pattern')">
        Czas egzaminu musi być uzupełniony według formatu HH:MM
      </mat-error>
    </mat-form-field>

    <p>Liczba pytań: {{examModel.questions?.length}}</p>
    <p>Maksymalna liczba punktów: {{this.examService.countCorrectAnswers(examModel)}}</p>

    <button type="button" (click)="addNewQuestion()" mat-raised-button color="primary">Dodaj pytanie</button>

    <mat-form-field appearance="outline">
      <mat-label>Rodzaj pytania</mat-label>
      <mat-select [(ngModel)]="newQuestionType" [ngModelOptions]="{standalone: true}">
        <mat-option [value]="'single'">
          Jednokrotny wybór
        </mat-option>
        <mat-option [value]="'multiple'">
          Wielokrotny wybór
        </mat-option>
        <mat-option [value]="'short'">
          Pisemna odpowiedź
        </mat-option>
      </mat-select>
      <mat-error
        *ngIf="difficultyLevelControl.hasError('required')">
        Poziom trudności jest wymagany
      </mat-error>
    </mat-form-field>


    <button type="submit" mat-raised-button color="primary">Zapisz zmiany</button>

  </div>

  <div *ngIf="examModel.questions?.length != 0" id="questions-list">
    <h1 style="text-align: center">Lista pytań</h1>
    <div *ngFor="let question of examModel.questions; let i = index">

      <div class="question {{question.type}}">

        <div id="question-options">
          <span>{{(i + 1) + "."}}</span>
          <mat-form-field appearance="outline" id="question-content-input">
            <mat-label>Treść pytania</mat-label>
            <input type="text" matInput required [ngModelOptions]="{standalone: true}"
                   [(ngModel)]="question.content">
          </mat-form-field>

          <button type="button" class="answer-content-button" mat-raised-button color="primary"
                  (click)="addNewAnswerToQuestion(question)">Dodaj odpowiedź
          </button>
          <button type="button" class="answer-content-button" mat-raised-button color="accent"
                  (click)="deleteThisQuestion(question)">Usuń pytanie
          </button>
        </div>

        <div id="answers" *ngFor="let answer of question.answers; let j = index">

          <div id="answer">
            <span>{{(i + 1) + "." + (j + 1) + "."}}</span>
            <mat-form-field appearance="outline" id="answer-content-input">
              <mat-label>Treść odpowiedzi</mat-label>
              <input type="text" matInput required [ngModelOptions]="{standalone: true}"
                     [(ngModel)]="answer.content">
            </mat-form-field>
            <mat-checkbox [(ngModel)]="answer.correctness" style="padding-top: 10px"
                          [ngModelOptions]="{standalone: true}"
                          [disabled]="question.type === 'short'" color="primary"
                          (change)="selectAnswer(answer, question)"
                          matTooltip="Kliknij, aby oznaczyć tę odpowiedź jako prawidłową"
                          matTooltipPosition="above">
            </mat-checkbox>
            <button type="button" mat-raised-button color="warn"
                    (click)="deleteThisAnswer(question, answer)"
                    matTooltip="Kliknij, aby usunąć tę odpowiedź"
                    matTooltipPosition="above">Usuń
            </button>
          </div>

        </div>

      </div>

    </div>
  </div>

  <div *ngIf="examModel.questions?.length === 0" id="empty-exam-list-info">
    <p> Egzamin nie zawiera żadnych pytań! Dodaj je :)</p>
  </div>

</form>
